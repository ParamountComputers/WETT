@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "CustomerOrder";
}

<div class="text-center">
    <h2 class="display-4">Customer Order</h2>
</div>
<fieldset class="scheduler-border">
  <div class="container-flow">
  <div class="row">
           <div class="col-sm-3">
          <label for="date"  style="font-size:10px;">Order Date:</label>
         <input type="date" value=""  style="font-size:10px;" id='date' name="date" />
         </div>   
           
           <div class="col-sm-4">
         <input type="text"  style="font-size:10px; border-radius: 0 !important" class="form-control" placeholder="Special Comments:" id="comments" name="comments"/>
             </div>
             <div class="col-md-1 ">
                 </div>
            <div class="col-sm-2 text-sm-right">
          <input type="text" style="font-size:10px; border-radius: 0 !important" name="input" class="form-control" placeholder="Order Number" id="saCode" readonly/>
           </div>
                <div class="col-sm-1">
                 </div>
            <div class="col-sm-1 text-right">
          <button class="btn btn-outline-secondary" style="font-size:10px;" id="save" type="button">Save</button>  
            </div>        
</div>
</div>
</fieldset>

<table id="customerOrder" style="align: center"></table>
<div id="jqGridPager"></div>
@section scripts {

<script type="text/javascript">

    $.jgrid.defaults.styleUI = 'Bootstrap';
     $.jgrid.defaults.responsive = true;
    var header = false;
    var curRowId = -1;
    var name ="";
    $(document).ready(function() {
       $("#customerOrder").jqGrid({
               url: 'CustomerOrder/GetAll',
               mtype: "GET",
               guiStyle: "bootstrap",
               iconSet: "fontAwesome",
               idPrefix: "gb1_",
               datatype: "json",
               ajaxSelectOptions: {
                          type: "GET", 
                          contentType: 'application/json; charset=utf-8',
                          dataType: "json",
                          cache: false,
                      },
               autowidth:true,
               colModel: [
                   {
                        label: "Edit Actions",
                        name: "actions",
                        width: 100,
                        formatter: "actions",
                        fixed:true,
                        formatoptions: {
                            keys: true,
                            editOptions: { },
                            addOptions: { },
                            delOptions: { url: 'CustomerOrder/Delete' }
                        }
                    },
                   { label: 'Customer',name: 'customerId', editable: true, fixed:true,edittype:'select',formatter:'select',editoptions: {value:getCustomer()}},
                   { label: 'Carrier',name: 'carrierId',fixed:true, editable: true,edittype:'select',formatter:'select',editoptions: {value:getCarrier()}},
                   { label: 'Order Status',name: 'customerOrderStatusId',fixed:true, editable: true,edittype:'select',formatter:'select',editoptions: {value:getCustomerOrderStatus()}},
                   { label: 'Order Number',name: 'orderNumber',fixed:true,editable: true, edittype:"text"},
                   { label: 'Date Ordered',name: 'dateOrdered',fixed:true,editable: true, edittype:"text"},
                   { label: 'Driver',name: 'driver',fixed:true,editable: true, edittype:"text"},
                   { label: 'DS Slip Number',name: 'dsSlipNumber',fixed:true,width:80,editable: true, edittype:"text"},
                   { label: 'Delivery Request Date',name: 'deliveryReqDate',fixed:true,width:120,editable: true, edittype:"text"},

                 ], 
               viewrecords: true,
               height: 500,
               rowNum: 20,
               pager: "#jqGridPager",
               editurl: 'CustomerOrder/Update',              

           })
               



           $('#customerOrder').navGrid('#jqGridPager',
               // the buttons to appear on the toolbar of the grid
               { edit: false,add:true, del: false, search: false, refresh: false, view: false, position: "left", cloneToTop: false },
              
               {
                  
               },
               {
          });
   });
       $(document).ready(function () {  
           $('#date').val(date());
       });
      
       $('#customerOrder').setGridWidth(parseInt($(window).width()) - 20);
       $("#date").on('change keyup paste', function () {
           SearchByDate();
           
       }); 
       $("#save").on('click', function () {
           SaveHeader();
        });

        function date()
        {
         var date;
         var currentDate = new Date();
         var day = ("0" + currentDate.getDate()).slice(-2);
         var month = ("0" + (currentDate.getMonth() + 1)).slice(-2);
         var today = currentDate.getFullYear() + "-" + (month) + "-" + (day);
         date = today.toString();
         return date;
        }
    
            function SaveHeader()
    {
         header = true;
         console.log($("#date").val());
        var date = $("#date").val();
        var notes = $("#comments").val();

        $.ajaxSetup( { "async": false } );
        $.getJSON('CustomerOrder/CreateHeader?data='+date+'/'+notes, function(data) {
 
        $("#saCode").val(data);
                    });
            $.ajaxSetup( { "async": true } );

    }


         function getCarrier() {
        var CarrierList= {};
        $.ajaxSetup( { "async": false } );
        $.getJSON('CustomerOrder/CreateCarrierList', function(data) {
        if (data != null) {
            for (var i = 0; i < data.length; i++) {
             CarrierList[data[i].value]=data[i].text;
                 
              }
            }//if

            });
            $.ajaxSetup( { "async": true } );

           return CarrierList; 

        }
                 function getCustomer() {
        var CustomerList= {};
        $.ajaxSetup( { "async": false } );
        $.getJSON('CustomerOrder/CreatetCustomerList', function(data) {
        if (data != null) {
            for (var i = 0; i < data.length; i++) {
             CustomerList[data[i].value]=data[i].text;
                 
              }
            }//if

            });
            $.ajaxSetup( { "async": true } );
            console.log(CustomerList);
           return CustomerList; 

        }
                 function getCustomerOrderStatus() {
        var CustomerOrderStatusList= {};
        $.ajaxSetup( { "async": false } );
        $.getJSON('CustomerOrder/CreatetCustomerOrderStatusList', function(data) {
        if (data != null) {
            for (var i = 0; i < data.length; i++) {
             CustomerOrderStatusList[data[i].value]=data[i].text;
                 
              }
            }//if

            });
            $.ajaxSetup( { "async": true } );

           return CustomerOrderStatusList; 

        }

</script>
}
