@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "invAdj";
}

<div class="text-center">
    <h1 class="display-4">Inventory Adjustment</h1>
</div>
<fieldset class="scheduler-border">
    <legend class="scheduler-border">Search</legend>
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Description" aria-label="Description" aria-describedby="basic-addon2" id="description">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button">Search</button>
        </div>
    </div>
</fieldset>

<table id="invAdj" style="align: center"></table>
<div id="jqGridPager"></div>

@section scripts {
<script type="text/javascript">

    $.jgrid.defaults.styleUI = 'Bootstrap';
    $.jgrid.defaults.responsive = true;

    $(document).ready(function() {
       $("#invAdj").jqGrid({
               url: 'invAdj/GetAll',
               mtype: "GET",
               guiStyle: "bootstrap",
               iconSet: "fontAwesome",
               idPrefix: "gb1_",
               datatype: "json",
               ajaxSelectOptions: {
                          type: "GET", 
                          contentType: 'application/json; charset=utf-8',
                          dataType: "json",
                          cache: false,
                      },
               autowidth:true,
               colModel: [
                   {
                        label: "Edit Actions",
                        name: "actions",
                        width: 125,
                        formatter: "actions",
                        formatoptions: {
                            keys: true,
                            editOptions: { },
                            addOptions: { },
                            delOptions: { url: 'Products/Delete' }
                        }
                    },

 			       { label: 'Product Id',name: 'productId',fixed:true,width:100, editable: true, edittype:"text", editoptions: { readonly: 'readonly'}, key: true},
                   { label: 'Supplier',name: 'name',fixed:true,width:100, editable: true, edittype:"text", editoptions: { readonly: 'readonly'}, key: true},
                   { label: 'Product Name',name: 'description',fixed:true,width:100, editable: true, edittype:"text", editoptions: { readonly: 'readonly'}, key: true},
                   { label: 'Locations',name: 'description',fixed:true,width:100, editable: true, edittype:"text", editoptions: { readonly: 'readonly'}, key: true},
                   { label: 'Updated Stock',name: 'amount',fixed:true,width:100, editable: true, edittype:"text", editoptions: { readonly: 'readonly'}, key: true},
                   { label: 'Reasons',name: 'description',fixed:true,width:100, editable: true, edittype:"text", editoptions: { readonly: 'readonly'}, key: true},
                   { label: 'Notes',name: 'comments',fixed:true,width:100, editable: true, edittype:"text", editoptions: { readonly: 'readonly'}, key: true}

                 ], 
               viewrecords: true,
               height: 250,
               rowNum: 20,
               pager: "#jqGridPager",
               editurl: 'Products/Update'
               //onSelectRow: editRow, // the javascript function to call on row click. will use to put the row in edit mode

           }).hideCol("productId");
               



           $('#invAdj').navGrid('#jqGridPager',
               // the buttons to appear on the toolbar of the grid
               { edit: false, add: true, del: false, search: false, refresh: false, view: false, position: "left", cloneToTop: false },
               // options for the Add Dialog
               {},
               {
                   closeAfterAdd: true,
                   recreateForm: true,
                   errorTextFormat: function (data) {
                       return 'Error: ' + data.responseText
                   },
                   url: "Products/Add"
               });

       });

       $('#invAdj').setGridWidth(parseInt($(window).width()) - 20);

       $("#description").on('change keyup paste', function () {
           SearchByProductName();
       });
        function getAllSelectOptions()
        {
        var sel = '<select>';
      
          sel +='<option value="">Select</option>';
        $.getJSON('Products/CreateList', function(data) {
        if (data != null) {
            alert(data.length);
            //construct string.  
            //(or the server could return a string directly)
             for (var i = 0; i < data.length; i++) {
            sel += '<option value="' + data[i].value + '">' + data[i].text + '</option>';
              //var sel = '';
              //sel += data[i].value  + ':' + data[i].text  + ',';
                         
                 }
                sel +="</select>";
              // sel = sel.substring(0,sel.length-1);
               //SupplierList= {sel};
                 }
                 alert(sel);
                  console.log(sel);
                return sel;
            });
         //var states = { '2': 'Carlsberg', '3': 'Moosehead Brewery', '15': 'Kokanee','16': 'mil'} ;
         //console.log(states);
         //alert(states.length);
         //return states;
        }
    function SearchByProductName()
    {
        //  Fetch the text from our <input> control
        var searchString = $("#description").val();

        //  Prepare to pass a new search filter to our jqGrid
        var f = { groupOp: "AND", rules: [] };

        //  Remember to change the following line to reflect the jqGrid column you want to search for your string in
        //  In this example, I'm searching through the UserName column.

        f.rules.push({ field: "name", op: "cn", data: searchString });

        var grid = $('#invAdj');
        grid[0].p.search = f.rules.length > 0;
        $.extend(grid[0].p.postData, { filters: JSON.stringify(f) });
        grid.trigger("reloadGrid", [{ page: 1 }]);
    }
        function getSequenceNumbers() {
            //var SupplierList = { '2': 'Carlsberg', '3': 'Moosehead Brewery', '15': 'Kokanee','16': 'mil'} ;
             //console.log(SupplierList);
            //return SupplierList;
          var SupplierList= {'2':'selectList'};
               SupplierList[15]='konakee';
         // var SupplierList;
         $.getJSON('Products/CreateList', function(data) {
        if (data != null) {
            for (var i = 0; i < data.length; i++) {
             SupplierList[data[i].value]=data[i].text;
             alertg(data[i].value);
              }
            }//if
           console.log(SupplierList);
           return SupplierList;  
            });
        }

        
</script>
}
